---
- name: Remove  docker swarm
  docker_swarm:
        force: yes
        state: absent

- name: Initializing docker swarm
  docker_swarm:
     state: present
- name: Update swarm configuration
  docker_swarm:
     state: present
     election_tick: 5
     
#- name: Find out id swarm node 
#  shell: "docker node ls -q -f name=mgdb-tf"
#  register: node_mgdb
  
#- debug:
#    var=node_mgdb.stdout 
  
#- name: Remove node from docker swarm
#  docker_swarm:
#        state: remove
#        node_id: "{{ node_mgdb.stdout }}"
        
- name: Inspect swarm
  docker_swarm_info:
  ignore_errors: yes
  register: result
  
- name: Add token to dummy host1
  add_host:
      name: worker_token1
      token: "{{ result.swarm_facts.JoinTokens.Worker }}"          


- name: Create a network with driver options
  docker_network:
    name: shop-socks
    driver: overlay
    driver_options:
        com.docker.network.overlay.name: net
    state: present
    attachable: yes            
                      
- debug: 
    msg: "IP address database server 1 variant is {{ hostvars['database'].ansible_facts.default_ipv4.address}}"
- debug: 
    msg: "IP address database server 2 variant is {{ hostvars['database']['ansible_default_ipv4']['address']}}"    